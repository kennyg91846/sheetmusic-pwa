<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#2b2b2b">
    <title>Sheet Music Catalog</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="assets/icons/icon192.png" type="image/png">
    <link rel="apple-touch-icon" href="assets/icons/icon192.png">
</head>
<body>

<header>
    <h1>Sheet Music Catalog</h1>
    <button id="addBtn">Add Score</button>
</header>

<main>
    <input type="text" id="searchInput" placeholder="Search title, composer, arranger, tags...">
    <select id="sortSelect" aria-label="Sort scores">
        <option value="title">Sort by Title</option>
        <option value="composer">Sort by Composer</option>
        <option value="liturgicalSeason">Sort by Liturgical Season</option>
        <option value="yearPublished">Sort by Year Published</option>
        <option value="lastPerformedDate">Sort by Last Performed Date</option>
    </select>
    <section id="syncControls" aria-label="Data sync controls">
        <button id="exportBtn" type="button">Export JSON</button>
        <button id="incrementalExportBtn" type="button">Export Incremental JSON</button>
        <button id="importBtn" type="button">Import + Append JSON</button>
        <button id="installBtn" type="button" class="hidden">Install App</button>
        <input id="importFileInput" type="file" accept="application/json,.json" class="hidden">
        <p id="syncStatus" aria-live="polite"></p>
        <p id="dbStatus" aria-live="polite">Program data is stored in this browser on this device and can be deleted by clearing this site's browser data. Export JSON regularly to keep a backup. Temporary until future updates.</p>
    </section>

    <section id="listView">
        <ul id="scoreList"></ul>
    </section>

    <section id="formView" class="hidden">
        <h2>Add / Edit Score</h2>
        <form id="scoreForm">
            <input type="text" id="title" placeholder="Title" aria-label="Title" required>
            <input type="text" id="composer" placeholder="Composer" aria-label="Composer">
            <input type="text" id="arranger" placeholder="Arranger" aria-label="Arranger">
            <input type="text" id="publisher" placeholder="Publisher" aria-label="Publisher">
            <input type="number" id="yearPublished" placeholder="Year Published" aria-label="Year Published">
            <input type="text" id="voicing" placeholder="Voicing (SATB, SAB, SSA, TTBB, Unison, etc.)" aria-label="Voicing (SATB, SAB, SSA, TTBB, Unison, etc.)">
            <input type="text" id="lastPerformedDate" placeholder="Last Performed Date" aria-label="Last Performed Date">
            <input type="number" id="licenseCount" placeholder="Number of Copies Owned" aria-label="Number of Copies Owned">
            <input type="text" id="liturgicalSeason" placeholder="Liturgical Season (Advent, Christmas, Lent, Palm Sunday, Maundy Thursday/Good Friday, Easter, Pentecost)" aria-label="Liturgical Season (Advent, Christmas, Lent, Palm Sunday, Maundy Thursday/Good Friday, Easter, Pentecost)">
            <textarea id="notes" placeholder="Notes" aria-label="Notes"></textarea>
            <button type="submit">Save</button>
        </form>
    </section>
</main>

<script src="db.js"></script>
<script src="ui.js"></script>
<script>
    let deferredInstallPrompt = null;
    const installBtn = document.getElementById("installBtn");

    document.getElementById("addBtn")?.addEventListener("click", () => {
        document.getElementById("listView")?.classList.add("hidden");
        document.getElementById("formView")?.classList.remove("hidden");
    });

    window.addEventListener("beforeinstallprompt", (event) => {
        event.preventDefault();
        deferredInstallPrompt = event;
        installBtn?.classList.remove("hidden");
    });

    installBtn?.addEventListener("click", async () => {
        if (!deferredInstallPrompt) {
            return;
        }

        deferredInstallPrompt.prompt();
        await deferredInstallPrompt.userChoice;
        deferredInstallPrompt = null;
        installBtn.classList.add("hidden");
    });

    window.addEventListener("appinstalled", () => {
        deferredInstallPrompt = null;
        installBtn?.classList.add("hidden");
    });

    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js");
    }
</script>

</body>
</html>
